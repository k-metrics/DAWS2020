---
title: "データ分析勉強会2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)

require(tidyverse)
```


## 分析大会用データについて

### 集計データ
集計データは、[厚生労働省のオープンデータ](https://www.mhlw.go.jp/stf/covid-19/open-data.html) を用います。詳細は当該のページで確認してください。

　  

### 個票データ
個票データは、[Covid19 Japan](https://covid19japan.com/) が GitHub で公開している [JSON形式の個票データ（CC BY-NC 4.0）](https://github.com/reustle/covid19japan-data/tree/master/docs/patient_data) のデータを加工した以下の形式のデータ（CSV形式）を用います。ファイルは Google Drive に格納します。

```{r, message=FALSE, echo=FALSE}
df <- "https://raw.githubusercontent.com/reustle/covid19japan-data/master/docs/patient_data/latest.json" %>% 
  jsonlite::fromJSON()

prefs <- "https://gist.githubusercontent.com/k-metrics/9f3fc18e042850ff24ad9676ac34764b/raw/9262c36b0740edd575e9f0292dad61c9cce269be/pref_utf8.csv" %>% 
  readr::read_csv() %>% 
  dplyr::rename(pcode = `コード`) %>% 
  dplyr::mutate(# pref = stringr::str_to_title(pref),
                # pcode = forcats::fct_inorder(pcode),
                fct_pref = forcats::fct_inorder(pref)) # ,
                # `都道府県` = forcats::fct_inorder(`都道府県`),
                # `八地方区分` = forcats::fct_inorder(`八地方区分`),
                # `広域圏` = forcats::fct_inorder(`広域圏`),
                # `通俗的区分` = forcats::fct_inorder(`通俗的区分`),
                # `推計人口` = as.integer(`推計人口`))

x <- df %>% 
  dplyr::select(patientId, date = dateAnnounced, gender,
                detectedPrefecture, patientStatus, knownCluster,
                confirmedPatient, residence,
                # charterFlightPassenger, cruisePassengerDisembarked,
                ageBracket, residence) %>% 
                # deceasedDate, deceasedReportedDate) %>% 
  # dplyr::filter(date < lubridate::today()) %>% 
  dplyr::filter(confirmedPatient == TRUE) %>% 
  # dplyr::mutate(date = lubridate::as_date(date),
  #               gender = forcats::as_factor(gender),
  #               patientStatus = forcats::as_factor(patientStatus),
  #               cluster = dplyr::if_else(!is.na(knownCluster), TRUE, FALSE),
  #               ageBracket = forcats::as_factor(ageBracket),
  #               deceasedDate = lubridate::as_date(deceasedDate),
  #               deceasedReportedDate = lubridate::as_date(deceasedReportedDate)) %>% 
  dplyr::left_join(prefs, by = c("detectedPrefecture" = "pref")) %>% 
  # dplyr::select(-`推計人口`, -pref) %>%
  # dplyr::select(pref) %>%
  dplyr::rename(pref = `都道府県`, region = `八地方区分`, populationｓ = `推計人口`) %>% 
  dplyr::select(-pcode, -`広域圏`, -`通俗的区分`, -fct_pref)
  # tidyr::drop_na(pref)

x %>% 
  head(10)
```

　  
オリジナルデータのデータフォーマットについては [こちら](https://github.com/reustle/covid19japan-data/blob/master/README_data_format.md) を参照してください。加工データについては以下の通りです。  

列名（変量名）     | データ形式 | 説明
-------------------|------------|----------------------------------------------
patientId          | String     | 陽性判定者の識別情報（厚生労働省のIDとは異なる）
confirmedPatient   | boolean    | FALSEの場合は重複報告などの可能性あり
dateAnnounced      | YYYY-MM-DD | 陽性判定の報告日（検査日ではない）
ageBracket         | Numeric    | 陽性者の年代（非公開あり）
gender             | String     | 陽性者の性別（非公開あり）
residence          | String     | 陽性者の居住地（非公開あり）
detectedPrefecture | String     | 報告主体（都道府県ならびに空港検疫など）
patientStatus      | String     | 陽性者の状態
knownCluster       | String     | 陽性者のクラスタに関する情報
pref               | String     | `detectedPrefecture` の日本語
region             | String     | 八地方区分
population         | Numeric    | H30年時点の推計情報（単位は千人、出典：統計局）

　  
なお、オリジナルデータをRを用いて直接読み込みたい場合には、以下のコードを利用してください（表示の都合上、URLを分割しています）。
```{r, echo=TRUE, eval=FALSE}
library(tidyverse)
library(jsonlite)
"https://raw.githubusercontent.com/reustle/covid19japan-data/master/" %>% 
  paste0("docs/patient_data/latest.json") %>% 
  jsonlite::fromJSON()
```

　  

### その他データ
その他、関連データは以下から入手可能です。

* [都道府県地方区分ならびに推計人口](https://gist.github.com/k-metrics/9f3fc18e042850ff24ad9676ac34764b)
* [新型コロナウイルス対策病床オープンデータ](https://docs.google.com/spreadsheets/d/1u0Ul8TgJDqoZMnqFrILyXzTHvuHMht1El7wDZeVrpp8/edit#gid=0)

　  

## 注意事項

* 各データは予告なく内容などが変更される場合があります
* 各データはその内容を保証していません
* 各データの著作権などは原著作者にあります

　  

---
CC 4.0 BY-NC-SA, Sampo Suzuki